<!DOCTYPE html>
<html>
	<head>
		<title>floppy</title>
        <link type="text/css" rel="stylesheet" href="stylesheet.css" />
        <link href='https://fonts.googleapis.com/css?family=Press+Start+2P' rel='stylesheet' type='text/css'>
	</head>
	<body>
        <div id="canvas-container">
            <canvas id="canvas">Your browser doesn't support HTML5</canvas>
        </div>
		<script>
            var canvas = document.getElementById("canvas"),
                ctx = canvas.getContext("2d"),
                width = 1200,                                //canvas dimensions
                height = 600,
                player = {                                   //player object
                    x: width/2, 
                    y: height/2,                             //starting point, middle of canvas
                    width: 20,
                    height: 20,                              //canvas dimensions must be divisible player dimensions
                    move: 20
                },
                ball = {                                     //ball object
                    x: 200,
                    y: 200,
                    width: 20,
                    height: 20
                },
                box = new Image(),                           //image for boxes
                boxes = [],                                  //border/boundaries/obstacles
                upCheck = false,
                downCheck = false,                           //checks squares around player for collision with boxes
                rightCheck = false,
                leftCheck = false,
                upBall = false,
                downBall = false,                            //checks squares around player for ball
                rightBall = false,
                leftBall = false,
                upBlock = false,
                downBlock = false,                           //checks squares around ball for collision when player is near
                rightBlock = false,
                leftBlock = false;
                
            canvas.width = width;                            //applies dimensions to canvas
            canvas.height = height;
            box.src = "images/box.gif";
            
            function pad(number, digits) {                   //pads timer with leading '0's
                return Array(Math.max(digits - String(number).length + 1, 0)).join(0) + number;
            }
            
            function createTimer(seconds) {                  //creates timer
                intervalVar = setInterval(function () {
                    ctx.clearRect(0, 0, width, 80);
                    ctx.font = "20px 'Press Start 2P'";
                    ctx.fillStyle = "white";
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    var secondsToShow = (seconds).toString();
                   
                    ctx.fillText('LEVEL', 120, 25);
                    ctx.fillText('1-1', 120, 55);
                    ctx.fillText('TIME', 1065, 25);
                    ctx.fillText(pad(secondsToShow, 5), 1070, 55);
                    
                    seconds++;
                }, 1000);
            }
            
            function drawBorder() {                          //draws border: header and footer
                for (var i = 0; i < width / 20; i++) {                //create header blocks
                    boxes.push({
                        x: i * 20,
                        y: 80
                    });
                }
                for (var i = 0; i < width/ 20; i++) {        //create footer blocks
                    boxes.push({
                        x: i * 20,
                        y: height - 20,
                    });
                }
                for (var i = 0; i < boxes.length; i++) {     //draw header and footer
                    ctx.drawImage(box, boxes[i].x, boxes[i].y)
                }
            }
            
            function collisionCheck() {                      //check for collision
                for (var i = 0; i < boxes.length; i++) {
                    if (boxes[i].y == player.y - 20 && boxes[i].x == player.x) {
                        upCheck = true;
                        break;                               //if box is found above player
                    }
                    else {
                        upCheck = false;
                    }
                }
                for (var i = 0; i < boxes.length; i++) {
                    if (boxes[i].y == player.y + 20 && boxes[i].x == player.x) {
                        downCheck = true;
                        break;                               //box below player
                    }
                    else {
                        downCheck = false;
                    }
                }
                for (var i = 0; i < boxes.length; i++) {
                    if (boxes[i].y == player.y && boxes[i].x == player.x + 20) {
                        rightCheck = true;
                        break;                               //box to the right
                    }
                    else {
                        rightCheck = false;
                    }
                }
                for (var i = 0; i < boxes.length; i++) {
                    if (boxes[i].y == player.y && boxes[i].x == player.x - 20) {
                        leftCheck = true;
                        break;                               //box to the left
                    }
                    else {
                        leftCheck = false;
                    }
                }
                if (ball.y == player.y - 20 && ball.x == player.x) {
                    upBall = true;                           //ball is above player
                    for (var i = 0; i < boxes.length; i++) {
                        if (boxes[i].y == ball.y - 20 && boxes[i].x == ball.x) {
                            upBlock = true;
                            break;                           //box is above ball above player
                        }
                        else {
                            upBlock = false;
                        }
                    }
                }
                else {
                    upBall = false;
                }
                if (ball.y == player.y + 20 && ball.x == player.x) {
                    downBall = true;                         //ball is below player
                    for (var i = 0; i < boxes.length; i++) {
                        if (boxes[i].y == ball.y + 20 && boxes[i].x == ball.x) {
                            downBlock = true;
                            break;                           //box is below ball below player
                        }
                        else {
                            downBlock = false;
                        }
                    }
                }
                else {
                    downBall = false;
                }
                if (ball.y == player.y && ball.x == player.x + 20) {
                    rightBall = true;                        //ball is right of player
                    for (var i = 0; i < boxes.length; i++) {
                        if (boxes[i].y == ball.y && boxes[i].x == ball.x + 20) {
                            rightBlock = true;
                            break;                           //box is right of ball right of player
                        }
                        else {
                            rightBlock = false;
                        }
                    }
                }
                else {
                    rightBall = false;
                }
                if (ball.y == player.y && ball.x == player.x - 20) {
                    leftBall = true;                         //ball is left of player
                    for (var i = 0; i < boxes.length; i++) {
                        if (boxes[i].y == ball.y && boxes[i].x == ball.x - 20) {
                            leftBlock = true;
                            break;                           //box is left of ball left of player
                        }
                        else {
                            leftBlock = false;
                        }
                    }
                }
                else {
                    leftBall = false;
                }
            }

            function move(evt){                              //event (keyboard input)
                switch (evt.keyCode) {
                    case 38:                                 //Up arrow was pressed
                        if (player.y > 0 && upCheck == false){ 
                            if (upBall == true && upBlock == false) {
                                player.y -= player.move;
                                ball.y -= 20;                //if ball is above player, 
                            }
                            else if (upBall == false) {
                                player.y -= player.move;
                            }
                            collisionCheck();
                        }
                      break;
                    case 40:                                 //Down arrow was pressed
                        if (player.y + player.height < height && downCheck == false){ 
                            if (downBall == true && downBlock == false) {
                                player.y += player.move;
                                ball.y += 20;
                            }
                            else if (downBall == false) {
                                player.y += player.move;
                            }
                            collisionCheck();
                        }
                      break;
                    case 37:                                 //Left arrow was pressed
                        if (player.x > 0 && leftCheck == false){ 
                            if (leftBall == true && leftBlock == false) {
                                player.x -= player.move;
                                ball.x -= 20;
                            }
                            else if (leftBall == false) {
                                player.x -= player.move;
                            }
                            collisionCheck();
                      }
                      break;
                    case 39:                                 //Right arrow was pressed
                        if (player.x + player.width < width && rightCheck == false){ 
                            if (rightBall == true && rightBlock == false) {
                                player.x += player.move;
                                ball.x += 20;
                            }
                            else if (rightBall == false) {
                                player.x += player.move;
                            }
                            collisionCheck();
                      }
                      break;
                }
            }
           
            function init() {
          //      headerText();
                createTimer(0);
                drawBorder();
                return setInterval(update, 10);              //run update() every 10ms
            }
            
            function update() {
                ctx.clearRect(0, 100, width, height - 120);          //clears canvas
                ctx.fillStyle = "white";                     //player style + draw player
                ctx.fillRect(player.x, player.y, player.width, player.height);
                ctx.fillStyle = "#3498DB";
                ctx.fillRect(ball.x, ball.y, ball.width, ball.height);
            }

            window.addEventListener('keydown', move, true);  //if key is pressed, execute move()
            
            window.addEventListener("load", function(){      //start init() upon page load
                init();
            });
		</script>
	</body>
</html>
